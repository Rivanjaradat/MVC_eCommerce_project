@model List<Cart>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">

<div class="container py-5">
    <h1 class="mb-5">Your Shopping Cart</h1>
    <div class="row">
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-body">
                    @if (Model != null && Model.Any())
                    {
                        @foreach (var cartItem in Model)
                        {
                            <div class="row cart-item mb-3">
                                <div class="col-md-3">
                                    <img src="@cartItem.Product.Image" alt="Product" style="width: 100px; height: 100px; object-fit: cover; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);">

                                </div>
                                <div class="col-md-5">
                                    <h5 class="card-title">@cartItem.Product.Name</h5>
                                    <p class="text-muted">Category: </p>
                                </div>
                                <div class="col-md-2">
                                    <select class="form-select form-select-sm quantity-dropdown" data-id="@cartItem.Id">
                                        @for (int i = 1; i <= 10; i++)
                                        {
                                            if (i == cartItem.Qty)
                                            {
                                                <option value="@i" selected>@i</option>
                                            }
                                            else
                                            {
                                                <option value="@i">@i</option>
                                            }
                                        }
                                    </select>

                                </div>
                                <div class="col-md-2 text-end">
                                    <p class="fw-bold">$@(cartItem.Qty * cartItem.Product.Price)</p>
                                    <a asp-action="Remove" asp-controller="Cart" asp-route-id="@cartItem.Id" class="btn btn-sm btn-outline-danger">
                                        <i class="bi bi-trash"></i>
                                    </a>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-center text-muted">Your cart is empty.</p>
                    }
                </div>
            </div>

            <div class="text-start mb-4">
                <a  asp-action="Index" asp-controller="Home" class="btn btn-outline-primary">
                    <i class="bi bi-arrow-left me-2"></i>Continue Shopping
                </a>
            </div>
        </div>

        <div class="col-lg-4">
            <!-- Summary -->
            <div class="card cart-summary">
                <div class="card-body">
                    <h5 class="card-title mb-4">Order Summary</h5>
                    @{
                        var subtotal = Model.Sum(c => c.Product.Price * c.Qty);
                        var shipping = 10.0;
                        var tax = 0.15 * subtotal;
                        var total = subtotal ;
                    }
                    <div class="d-flex justify-content-between mb-3">
                        <span>Subtotal</span>
                        <span>$@subtotal</span>
                    </div>
                   @* <div class="d-flex justify-content-between mb-3">
                        <span>Shipping</span>
                        <span>$@shipping</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span>Tax</span>
                        <span>$@tax.ToString("0.00")</span>
                    </div>*@
                    <hr>
                    <div class="d-flex justify-content-between mb-4">
                        <strong>Total</strong>
                        <strong>$@total.ToString("0.00")</strong>
                    </div>
                    <a asp-action="Index" asp-controller="CheckOut" class="btn btn-primary w-100">Proceed to Checkout</a>

                </div>
            </div>

            <div class="card mt-4">
                <div class="card-body">
                    <h5 class="card-title mb-3">Apply Promo Code</h5>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" placeholder="Enter promo code">
                        <button class="btn btn-outline-secondary" type="button">Apply</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $(".quantity-dropdown").change(function () {
            var id = $(this).data("id");
            var quantity = $(this).val();

            $.ajax({
                url: '@Url.Action("UpdateQty", "Cart")',
                type: 'POST',
                data: { id: id, quantity: quantity },
                success: function () {
                    location.reload();
                },
                error: function (error) {
                    alert("Error: " + error.responseText);
                }
            });
        });
    });
</script>
